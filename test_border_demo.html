<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Border Consistency & No Background</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx-js-style@1.2.0/dist/xlsx.bundle.js"></script>
</head>
<body>
    <h1>Test: Border Rata + Tanpa Background Berwarna</h1>
    <button onclick="generateTestExcel()">Generate Test Excel File</button>
    
    <div style="margin-top: 20px; padding: 15px; background: #f0f8ff; border-radius: 5px;">
        <h3>📋 Checklist Verifikasi:</h3>
        <ul>
            <li>✅ Border header harus <strong>medium (tebal)</strong> dan konsisten</li>
            <li>✅ Border data cell harus <strong>thin (tipis)</strong> tapi rata</li>
            <li>✅ Border total row harus <strong>medium (tebal)</strong></li>
            <li>✅ <strong>TIDAK ADA</strong> background berwarna - semua cell putih</li>
            <li>✅ Header ter-center dan bold</li>
            <li>✅ Merge warehouse headers terlihat professional</li>
        </ul>
    </div>
    
    <script>
        function generateTestExcel() {
            console.log('Generating test Excel with consistent borders and no colored backgrounds...');

            const xlsxLib = typeof XLSX_STYLE !== 'undefined' ? XLSX_STYLE : XLSX;
            const hasAdvancedStyling = typeof XLSX_STYLE !== 'undefined';
            
            console.log('Using library:', hasAdvancedStyling ? 'XLSX-JS-STYLE' : 'Standard XLSX');

            // Test data yang mirip struktur asli
            const testData = [
                ['LAPORAN STOK BARANG'],
                ['SUN FIREWORKS'],
                [''],
                ['NO', 'KODE PRODUK', 'NAMA PRODUK', 'KATEGORI', 'Royal', '', 'G3-Updated', ''],
                ['', '', '', '', 'Carton', 'Pack', 'Carton', 'Pack'],
                ['1', 'IF RC0805 A-2', 'Roman Candle 0.8" 5 shots A-2', 'ROMAN CANDLE', '100', '100', '9', '19'],
                ['2', 'IF RC0808 A-1', 'Roman Candle 0.8" 8 shots A-1', 'ROMAN CANDLE', '43', '27', '0', '5'],
                ['3', 'IF W667', 'Dinosaurus isi 10', 'SMALL ITEMS', '45', '24', '2', '0'],
                ['', '', '', 'TOTAL', '188', '151', '11', '24']
            ];

            const ws = xlsxLib.utils.aoa_to_sheet(testData);

            if (hasAdvancedStyling) {
                // Define styles - NO COLORED BACKGROUNDS, CONSISTENT BORDERS
                const titleStyle = {
                    font: { name: "Arial", sz: 14, bold: true, color: { rgb: "000000" } },
                    alignment: { horizontal: "center", vertical: "center" }
                };

                const headerStyle = {
                    font: { name: "Arial", sz: 10, bold: true, color: { rgb: "000000" } },
                    alignment: { horizontal: "center", vertical: "center" },
                    border: {
                        top: { style: "medium", color: { rgb: "000000" } },
                        bottom: { style: "medium", color: { rgb: "000000" } },
                        left: { style: "medium", color: { rgb: "000000" } },
                        right: { style: "medium", color: { rgb: "000000" } }
                    }
                };

                const dataStyle = {
                    font: { name: "Arial", sz: 9, color: { rgb: "000000" } },
                    alignment: { horizontal: "center", vertical: "center" },
                    border: {
                        top: { style: "thin", color: { rgb: "000000" } },
                        bottom: { style: "thin", color: { rgb: "000000" } },
                        left: { style: "thin", color: { rgb: "000000" } },
                        right: { style: "thin", color: { rgb: "000000" } }
                    }
                };

                const productNameStyle = {
                    font: { name: "Arial", sz: 9, color: { rgb: "000000" } },
                    alignment: { horizontal: "left", vertical: "center" },
                    border: {
                        top: { style: "thin", color: { rgb: "000000" } },
                        bottom: { style: "thin", color: { rgb: "000000" } },
                        left: { style: "thin", color: { rgb: "000000" } },
                        right: { style: "thin", color: { rgb: "000000" } }
                    }
                };

                const totalStyle = {
                    font: { name: "Arial", sz: 10, bold: true, color: { rgb: "000000" } },
                    alignment: { horizontal: "center", vertical: "center" },
                    border: {
                        top: { style: "medium", color: { rgb: "000000" } },
                        bottom: { style: "medium", color: { rgb: "000000" } },
                        left: { style: "medium", color: { rgb: "000000" } },
                        right: { style: "medium", color: { rgb: "000000" } }
                    }
                };

                // Apply styles to all cells
                const range = xlsxLib.utils.decode_range(ws['!ref']);
                
                for (let row = 0; row <= range.e.r; row++) {
                    for (let col = 0; col <= range.e.c; col++) {
                        const cellAddr = xlsxLib.utils.encode_cell({ r: row, c: col });
                        
                        if (!ws[cellAddr]) {
                            ws[cellAddr] = { t: 's', v: '' };
                        }

                        // Apply styles based on position
                        if (row === 0 || row === 1) {
                            // Title rows - no borders, center alignment
                            ws[cellAddr].s = titleStyle;
                        } else if (row === 3 || row === 4) {
                            // Header rows - MEDIUM borders, NO background
                            ws[cellAddr].s = headerStyle;
                        } else if (row === 8) {
                            // Total row - MEDIUM borders, NO background
                            ws[cellAddr].s = totalStyle;
                        } else if (row > 4 && row < 8) {
                            // Data rows - thin borders
                            if (col === 2) {
                                // Product name - left aligned
                                ws[cellAddr].s = productNameStyle;
                            } else {
                                ws[cellAddr].s = dataStyle;
                            }
                        }
                    }
                }

                // Add merge cells for warehouse headers
                ws['!merges'] = [
                    { s: { r: 0, c: 0 }, e: { r: 0, c: 7 } }, // Title
                    { s: { r: 1, c: 0 }, e: { r: 1, c: 7 } }, // Company
                    { s: { r: 3, c: 4 }, e: { r: 3, c: 5 } }, // Royal
                    { s: { r: 3, c: 6 }, e: { r: 3, c: 7 } }  // G3-Updated
                ];

                console.log('✅ Applied consistent borders with NO colored backgrounds');
            }

            // Set column widths
            ws['!cols'] = [
                { wch: 5 },   // NO
                { wch: 15 },  // KODE PRODUK
                { wch: 35 },  // NAMA PRODUK
                { wch: 15 },  // KATEGORI
                { wch: 10 },  // Carton
                { wch: 8 },   // Pack
                { wch: 10 },  // Carton
                { wch: 8 }    // Pack
            ];

            // Create workbook
            const wb = xlsxLib.utils.book_new();
            xlsxLib.utils.book_append_sheet(wb, ws, 'Border Test - No Background');

            // Generate filename
            const filename = `border_test_no_background_${new Date().toISOString().split('T')[0]}.xlsx`;

            // Write file
            try {
                if (hasAdvancedStyling) {
                    xlsxLib.writeFile(wb, filename, {
                        cellStyles: true,
                        bookType: 'xlsx'
                    });
                } else {
                    xlsxLib.writeFile(wb, filename);
                }
                
                console.log('✅ Test file generated:', filename);
                
                alert(`File berhasil dibuat: ${filename}

Silakan buka file di Excel/LibreOffice untuk verifikasi:

✅ BORDER HEADER: Medium (tebal) dan rata
✅ BORDER DATA: Thin (tipis) tapi konsisten  
✅ BORDER TOTAL: Medium (tebal)
✅ BACKGROUND: Tidak ada warna - semua putih
✅ ALIGNMENT: Header center, nama produk left
✅ MERGE: Warehouse headers merged dengan baik`);
            } catch (error) {
                console.error('❌ Error generating file:', error);
                alert('Error: ' + error.message);
            }
        }
    </script>
</body>
</html>
