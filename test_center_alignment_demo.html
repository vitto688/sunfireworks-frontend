<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test XLSX Center Alignment</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx-js-style@1.2.0/dist/xlsx.bundle.js"></script>
</head>
<body>
    <h1>Test XLSX-JS-Style Center Alignment</h1>
    <button onclick="generateTestExcel()">Generate Test Excel File</button>
    
    <script>
        function generateTestExcel() {
            console.log('Generating test Excel file...');
            console.log('XLSX version:', typeof XLSX !== 'undefined' ? XLSX.version : 'Not available');
            console.log('XLSX_STYLE available:', typeof XLSX_STYLE !== 'undefined');

            // Use XLSX_STYLE if available, fallback to XLSX
            const xlsxLib = typeof XLSX_STYLE !== 'undefined' ? XLSX_STYLE : XLSX;
            const hasAdvancedStyling = typeof XLSX_STYLE !== 'undefined';
            
            console.log('Using library:', hasAdvancedStyling ? 'XLSX-JS-STYLE' : 'Standard XLSX');

            // Test data
            const testData = [
                ['LAPORAN STOK BARANG'],
                ['SUN FIREWORKS'],
                [''],
                ['NO', 'NAMA PRODUK', 'KATEGORI', 'WAREHOUSE A', '', 'WAREHOUSE B', ''],
                ['', '', '', 'Carton', 'Pack', 'Carton', 'Pack'],
                ['1', 'Test Product 1', 'Test Category', '10', '5', '15', '8'],
                ['2', 'Test Product 2', 'Test Category', '20', '12', '25', '15'],
                ['', '', '', 'TOTAL', '30', '17', '40', '23']
            ];

            // Create worksheet
            const ws = xlsxLib.utils.aoa_to_sheet(testData);

            // Define styles
            const titleStyle = {
                font: {
                    name: "Arial",
                    sz: 16,
                    bold: true,
                    color: { rgb: "000000" }
                },
                alignment: {
                    horizontal: "center",
                    vertical: "center"
                },
                fill: {
                    fgColor: { rgb: "E8F4F8" }
                }
            };

            const headerStyle = {
                font: {
                    name: "Arial",
                    sz: 11,
                    bold: true,
                    color: { rgb: "000000" }
                },
                alignment: {
                    horizontal: "center",
                    vertical: "center"
                },
                fill: {
                    fgColor: { rgb: "D4EDDA" }
                },
                border: {
                    top: { style: "thin", color: { rgb: "000000" } },
                    bottom: { style: "thin", color: { rgb: "000000" } },
                    left: { style: "thin", color: { rgb: "000000" } },
                    right: { style: "thin", color: { rgb: "000000" } }
                }
            };

            const dataStyle = {
                font: {
                    name: "Arial",
                    sz: 9,
                    color: { rgb: "000000" }
                },
                alignment: {
                    horizontal: "center",
                    vertical: "center"
                },
                border: {
                    top: { style: "thin", color: { rgb: "000000" } },
                    bottom: { style: "thin", color: { rgb: "000000" } },
                    left: { style: "thin", color: { rgb: "000000" } },
                    right: { style: "thin", color: { rgb: "000000" } }
                }
            };

            if (hasAdvancedStyling) {
                // Apply styles to all cells
                const range = xlsxLib.utils.decode_range(ws['!ref']);
                
                for (let row = 0; row <= range.e.r; row++) {
                    for (let col = 0; col <= range.e.c; col++) {
                        const cellAddr = xlsxLib.utils.encode_cell({ r: row, c: col });
                        
                        if (!ws[cellAddr]) {
                            ws[cellAddr] = { t: 's', v: '' };
                        }

                        // Apply styles based on row
                        if (row === 0 || row === 1) {
                            ws[cellAddr].s = titleStyle;
                        } else if (row === 3 || row === 4) {
                            ws[cellAddr].s = headerStyle;
                        } else if (row > 4) {
                            ws[cellAddr].s = dataStyle;
                        }
                    }
                }

                // Add merge cells
                ws['!merges'] = [
                    { s: { r: 0, c: 0 }, e: { r: 0, c: 6 } }, // Title
                    { s: { r: 1, c: 0 }, e: { r: 1, c: 6 } }, // Company
                    { s: { r: 3, c: 3 }, e: { r: 3, c: 4 } }, // Warehouse A
                    { s: { r: 3, c: 5 }, e: { r: 3, c: 6 } }  // Warehouse B
                ];

                console.log('Applied advanced styling with center alignment');
            } else {
                console.log('Standard XLSX - no advanced styling applied');
            }

            // Set column widths
            ws['!cols'] = [
                { wch: 5 },   // NO
                { wch: 25 },  // NAMA PRODUK
                { wch: 15 },  // KATEGORI
                { wch: 10 },  // Carton
                { wch: 8 },   // Pack
                { wch: 10 },  // Carton
                { wch: 8 }    // Pack
            ];

            // Create workbook
            const wb = xlsxLib.utils.book_new();
            xlsxLib.utils.book_append_sheet(wb, ws, 'Test Center Alignment');

            // Generate filename
            const filename = `test_center_alignment_${new Date().toISOString().split('T')[0]}.xlsx`;

            // Write file
            try {
                if (hasAdvancedStyling) {
                    xlsxLib.writeFile(wb, filename, {
                        cellStyles: true,
                        bookType: 'xlsx'
                    });
                } else {
                    xlsxLib.writeFile(wb, filename);
                }
                
                console.log('✅ Test file generated:', filename);
                alert(`File berhasil dibuat: ${filename}\n\nSilakan buka file di Excel/LibreOffice untuk memeriksa apakah header sudah ter-center dengan benar.`);
            } catch (error) {
                console.error('❌ Error generating file:', error);
                alert('Error: ' + error.message);
            }
        }
    </script>
</body>
</html>
